<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:p="http://primefaces.org/ui"
             xmlns:f="http://xmlns.jcp.org/jsf/core">

    <div class="col-12" style="height: 100%; padding-bottom: 60px">
        <div class="card shadow mb-4" style="height: 100%;">
            <!-- Title -->
            <div class="row" style="margin-left: 20px; margin-right: 20px; margin-top: 10px; margin-bottom: 10px">
                <div class="col-2">
                    <p:commandButton value="Retour" icon="pi pi-angle-left"
                              process="@this" ajax="true"
                              actionListener="#{viewEditionBean.init()}"
                              action="#{newThesaurusBean.init()}" update="containerIndex"
                              styleClass="ui-button-outlined ui-button-secondary" />
                </div>
                <div class="col-8" style="font-size: 14px; text-align: center">
                    <!--<h:outputText value="#{langueBean.getMsg('toolbox.modifyThesaurus')} : "/>-->
                    <h:outputText value="#{editThesaurusBean.nodeIdValueOfThesaurus.value} (#{editThesaurusBean.nodeIdValueOfThesaurus.id})"
                                  style="color: #C63632; font-weight: bold; font-size: 1.2rem"/>
                </div>
                <div class="col-2" style="text-align: right">
                    <p:linkButton href="https://opentheso.hypotheses.org/2991"
                                  target="_blank" icon="fa-solid fa-circle-question"
                                  styleClass="rounded-button ui-button-outlined" />
                </div>
            </div>            
            
            <div class="card mb-4 py-3 border-left-success" style="margin-left: 30px; margin-right: 30px;">

                <!-- choix de la langue par defaut -->
                <div class="row" style="margin-top: 10px">
                    <div class="col-3" style="text-align: right">
                        <h:outputText value="#{langueBean.getMsg('toolbox.defaultLanguage')}"/>
                    </div>
                    <div class="col-5" >
                        <h:panelGroup >
                            <h:panelGroup id="icon" style="margin-right: 5px; " >
                                <img src="#{conceptView.getDrapeauImgLocal(editThesaurusBean.preferredLang)}" width="27" height="22" />
                            </h:panelGroup>                            

                            <p:selectOneMenu value="#{editThesaurusBean.preferredLang}" styleClass="selectOneMenu_custom"
                                             panelStyleClass="selectOneMenu_panelStyle_custom"
                                             style="min-width: 200px; background: none;  box-shadow: none; "
                                             panelStyle="border: none; box-shadow: none;" var="lang">
                                <f:selectItems value="#{editThesaurusBean.languagesOfThesaurus}" itemValue="#{lang.code}"
                                               itemLabelEscaped="false" var="lang"
                                               itemLabel=" #{lang.value}" />
                                <p:column style="padding: 0.4rem 0.4rem;"><img src="#{conceptView.getDrapeauImgLocal(lang)}" width="25" height="20" style="margin-right: 10px;"/> #{lang} </p:column>
                                
                                <p:ajax event="change" listener="#{editThesaurusBean.changeSourceLang()}" update="containerIndex messageIndex"  />
                            </p:selectOneMenu>
                        </h:panelGroup>
                    </div>
                </div>
                <!-- Statut du thésaurus -->
                <div class="row" style="margin-top: 10px">
                    <div class="col-3" style="text-align: right">
                        <h:outputText value="#{langueBean.getMsg('toolbox.makeThesaurusPrivate')}" />
                    </div>
                    <div class="col-5" >
                        <p:toggleSwitch label="Public/Privé" value="#{editThesaurusBean.privateThesaurus}" style="height: 25px;">
                            <p:ajax listener="#{editThesaurusBean.changeStatus()}" update="containerIndex messageIndex" />
                        </p:toggleSwitch>
                    </div>
                </div>

                <!-- Générer l'identifiant pérenne pour le thésaurus -->
                <div class="row" style="margin-top: 10px">
                    <div class="col-3" style="text-align: right">
                        <h:outputText value="#{langueBean.getMsg('rightbody.concept.generate_ark')}" />
                    </div>
                    <div class="col-1" >
                        <p:commandButton value="#{langueBean.getMsg('service.generate')}"
                                         action="#{editThesaurusBean.generateArkId()}"
                                         update="containerIndex messageIndex"/>
                    </div>
                    <div class="col-4" >
                        <h:outputText value="#{editThesaurusBean.arkIdOfThesaurus}"/>
                    </div>
                </div>

                <!-- Modifier l'Identifiant du thésaurus -->
                <div class="row" style="margin-top: 10px">
                    <div class="col-3" style="text-align: right">
                        <h:outputText value="#{langueBean.getMsg('toolbox.modifyThesaurusId')}" />
                    </div>
                    <div class="col-1" >
                        <p:commandButton value="#{langueBean.getMsg('candidat.edit')}"
                                         actionListener="#{editThesaurusBean.reset()}"
                                         update="idChangeIdOfThesaurus"
                                         oncomplete="PF('changeIdOfThesaurus').show();" process="@this"/>
                    </div>
                </div>
            </div>
            
            <!-- gestion des langues -->
            <div class="card mb-4 py-3 border-left-success" style="margin-left: 30px; margin-right: 30px; margin-top: 10px; margin-bottom: 30px; ">
                <!-- Liste des langues à modifier -->
                <div class="row" style="margin-left: 20px; margin-right: 20px;">
                    <div class="col-12">
                        <p:tabView id="settingsPanels" dynamic="true" cache="true" activeIndex="#{editThesaurusBean.activeTabIndex}">
                            <p:tab title="Langues">
                                <!-- Ajout d'une langue au thésaurus -->
                                <div class="row" style="margin-bottom: 10px; text-align: right;">
                                    <div class="col-12"  >
                                        <p:commandButton value="#{langueBean.getMsg('toolbox.addLanguage')}" styleClass="ui-button-success" icon="fas fa-plus-circle"
                                                         update="idAddLangToTheso"
                                                         actionListener="#{editThesaurusBean.setLangSelected(null)}"
                                                         oncomplete="PF('addLangToTheso').show();" process="@this"/>
                                    </div>
                                </div>

                                <p:dataTable id="listLangThes" value="#{editThesaurusBean.languagesOfThesaurus}" var="langOfTheso" scrollable="true"
                                             resizableColumns="true" scrollHeight="250" reflow="true" lazy="false">

                                    <p:column width="55" headerText="#{langueBean.getMsg('statistique.label')}">
                                        <h:outputLabel value="#{langOfTheso.labelTheso}"/>
                                    </p:column>

                                    <p:column width="15" headerText="#{langueBean.getMsg('rightbody.conceptdialog.language')}">
                                        <img src="#{conceptView.getDrapeauImgLocal(langOfTheso.codeFlag)}" width="25" height="20"/>
                                        <h:outputLabel value=" (#{langOfTheso.code})" style="font-size: 14px; margin-left: 10px;" />
                                    </p:column>

                                    <p:column width="15" headerText="#{langueBean.getMsg('candidat.edit')}">
                                        <p:commandButton icon="fa-solid fa-pencil" update="containerIndex:idEditLangToThesaurus"
                                                         oncomplete="PF('editLangToThesaurus').show()" process="@this" style="color: #f47b2a"
                                                         actionListener="#{editThesaurusBean.setLangSelected(langOfTheso)}"
                                                         styleClass="rounded-button ui-button-outlined" />
                                    </p:column>

                                    <p:column width="15" headerText="#{langueBean.getMsg('candidat.remove')}">
                                        <p:commandButton styleClass="ui-button-danger rounded-button" icon="pi pi-trash"
                                                         actionListener="#{editThesaurusBean.deleteLangFromThesaurus(langOfTheso.code)}"
                                                         update="containerIndex messageIndex" process="@this" />
                                    </p:column>
                                    <a href="../../setting/corpus.xhtml"></a>
                                </p:dataTable>
                            </p:tab>

                            <p:tab title="Métadonnées">
                                <div class="row" style="margin-bottom: 10px; text-align: right;">
                                    <div class="col-12">
                                        <p:commandButton value="#{langueBean.getMsg('toolbox.addMetadata')}"
                                                         styleClass="ui-button-success" icon="fas fa-plus-circle"
                                                         process="@this" ajax="true" update="containerIndex messageIndex"
                                                         action="#{thesaurusMetadataAdd.onAddNew()}" />
                                    </div>
                                </div>
                                <p:dataTable id="metadataTheso" widgetVar="metadataTheso" var="dcElement" value="#{thesaurusMetadataAdd.dcElements}"
                                             editable="true" scrollHeight="250" scrollable="true" lazy="false">

                                    <p:ajax event="rowEdit" listener="#{thesaurusMetadataAdd.onRowEdit}" process="@this" update="containerIndex:metadataTheso messageIndex"/>

                                    <p:column width="10%" headerText="#{langueBean.getMsg('toolbox.metadata_property')}">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{dcElement.name}"/></f:facet>
                                            <f:facet name="input">
                                                <p:selectOneMenu  value="#{dcElement.name}" styleClass="selectOneMenu_custom"
                                                                  panelStyleClass="selectOneMenu_panelStyle_custom"
                                                                  style=" background: none;  box-shadow: none; "
                                                                  panelStyle="border: none; box-shadow: none;">
                                                    <f:selectItems value="#{thesaurusMetadataAdd.dcmiResource}" itemValue="#{dcmi}"
                                                                   itemLabelEscaped="false" var="dcmi"
                                                                   itemLabel=" #{dcmi}" />
                                                </p:selectOneMenu>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column width="40%" headerText="#{langueBean.getMsg('candidat.value')}">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{dcElement.value}"/></f:facet>
                                            <f:facet name="input"><p:inputText value="#{dcElement.value}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column  width="12%" headerText="#{langueBean.getMsg('rightbody.conceptdialog.language')}">
                                        <p:cellEditor >
                                            <f:facet name="output"><h:outputText value="#{dcElement.language}"/></f:facet>
                                            <f:facet name="input">
                                                <p:selectOneMenu id="languageDc" value="#{dcElement.language}" styleClass="selectOneMenu_custom"
                                                                 panelStyleClass="selectOneMenu_panelStyle_custom"
                                                                 style=" background: none;  box-shadow: none; "
                                                                 panelStyle="border: none; box-shadow: none; " var="lang">
                                                    <f:selectItem itemLabel="..." itemValue="" />
                                                    <f:selectItems value="#{editThesaurusBean.languagesOfThesaurus}" itemValue="#{lang.code}"
                                                                   itemLabelEscaped="false" var="lang"
                                                                   itemLabel=" #{lang.value}" />
                                                    <p:column style="padding: 0.4rem 0.4rem;"><img src="#{conceptView.getDrapeauImgLocal(lang)}" width="25" height="20"
                                                                                                   style="margin-right: 10px;"/> #{lang} </p:column>
                                                    <p:ajax event="change" update="propertieDc" listener="#{thesaurusMetadataAdd.initType(dcElement)}" />
                                                </p:selectOneMenu>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column width="15%" headerText="#{langueBean.getMsg('statistique.type')}">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{dcElement.type}"/></f:facet>
                                            <f:facet name="input">
                                                <p:selectOneMenu id="propertieDc" value="#{dcElement.type}" styleClass="selectOneMenu_custom"
                                                                 panelStyleClass="selectOneMenu_panelStyle_custom"
                                                                 style=" background: none;  box-shadow: none; "
                                                                 panelStyle="border: none; box-shadow: none;">
                                                    <f:selectItem itemLabel="..." itemValue="" />
                                                    <f:selectItems value="#{thesaurusMetadataAdd.dcmiTypes}" itemValue="#{dcmitype}"
                                                                   itemLabelEscaped="false" var="dcmitype"
                                                                   itemLabel=" #{dcmitype}" />
                                                    <p:ajax event="change" update="languageDc" listener="#{thesaurusMetadataAdd.initlanguage(dcElement)}" />
                                                </p:selectOneMenu>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column width="15%" style=" text-align: right">
                                        <p:rowEditor/>
                                    </p:column>

                                    <p:column width="5%" style="text-align: right">
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <p:commandButton styleClass="ui-button-danger rounded-button" icon="pi pi-trash"
                                                                 actionListener="#{thesaurusMetadataAdd.deleteThesaurusMetadata(dcElement)}"
                                                                 update="containerIndex:listLangThes metadataTheso messageIndex" process="@this" />
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:commandButton disabled="true" styleClass="ui-button-danger rounded-button" icon="pi pi-trash"
                                                                 actionListener="#"
                                                                 update="containerIndex:listLangThes messageIndex" process="@this" />
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                </p:dataTable>
                            </p:tab>

                            <p:tab title="Collections">
                                <p:treeTable id="listGroupsThes" value="#{editThesaurusBean.groupRoot}" var="groupThesorus"
                                             emptyMessage="Aucune collection n'est disponible">
                                    <p:column headerText="#{langueBean.getMsg('statistique.label')}">
                                        <h:outputLabel value="#{groupThesorus.lexicalValue}"/>
                                    </p:column>
                                    <p:column headerText="#{langueBean.getMsg('toolbox.publicPrivate')}">
                                        <p:toggleSwitch value="#{groupThesorus.groupPrivate}" style="margin-top: 5px">
                                            <p:ajax listener="#{editThesaurusBean.updateCollectionStatus(groupThesorus)}"
                                                    update="messageIndex containerIndex:settingsPanels"/>
                                        </p:toggleSwitch>
                                    </p:column>
                                </p:treeTable>
                            </p:tab>
                        </p:tabView>
                    </div>
                </div>
            </div>
            
            <ui:include src="../../toolbox/edition/editLangToTheso.xhtml" />
        </div>
    </div>
</ui:fragment>
