<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"  
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:p="http://primefaces.org/ui">

    <div class="row">
        <div class="col-12" style="text-align: center; margin-top: 10px; font-size: 14px;">
            <b>
                <h:outputText value="#{langueBean.getMsg('candidat.file')} "/>
                <h:outputText style="font-size: 14px; color: #f47b2a;" value=" (#{candidatBean.candidatSelected.createdBy})"
                              title="#{langueBean.getMsg('rightbody.concept.createdBy')} #{candidatBean.candidatSelected.createdBy}"/>
            </b>
        </div>
    </div>

    <div class="card mb-4 py-3 border-left-success" style="margin-top: 10px;">
        <div class="list-group" style="margin-top: -10px; margin-bottom: -10px; margin-left: 11px; margin-right: 11px">
            <!-- prefLabel -->
            <h:panelGroup id="vote" class="grid ui-fluid">
                <div class="row">
                    <div class="col-12 md:col-4">
                        <b><h:outputText value="#{langueBean.getMsg('candidat.title')} *" style="font-size: 14px;"/></b>
                    </div>
                    <div class="col-12 md:col-4">
                        <div class="ui-inputgroup">
                            <p:inputText id="inputTextCandidate" readonly="#{!candidatBean.isMyCandidate() }"
                                         value="#{candidatBean.candidatSelected.nomPref}" />

                            <p:inputText id="candidateLabel2" rendered="#{candidatBean.isNewCandidatActivate()}"
                                         value="#{candidatBean.candidatSelected.nomPref}" />

                            <p:commandButton rendered="#{candidatBean.candidatSelected.voted}"
                                             actionListener="#{candidatBean.addVote()}" update="vote"
                                             icon="fas fa-thumbs-up" style="color : #FFF;"/>

                            <p:commandButton rendered="#{!candidatBean.candidatSelected.voted}"
                                             actionListener="#{candidatBean.addVote()}" update="vote"
                                             icon="fas fa-thumbs-down" style="color: #FFF"/>

                            <p:tooltip for="inputTextCandidate" value="Ne peut être modifié que par le créateur"
                                       showDelay="1000" position="top"/>
                        </div>
                    </div>
                </div>
            </h:panelGroup>

            <!-- pour la première définition qui est obligatoire-->
            <h:panelGroup id="candidateDef" rendered="#{candidatBean.isNewCandidatActivate()}" style="margin-top: 10px">
                <div class="row">
                    <div class="col-12 md:col-4">
                        <b><h:outputText value="#{langueBean.getMsg('candidat.definition')} *" style="font-size: 14px; "/></b>
                    </div>
                    <div class="col-12 md:col-4">
                        <div class="ui-inputgroup">
                            <p:textEditor id="textEditorDef" widgetVar="DefinitionNew"
                                          value="#{candidatBean.definition}" allowLinks="true"
                                          secure="false" height="100" style="font-size: 12px; color: black; border-color: #43B572; width: 100%;"
                                          placeholder="#{langueBean.getMsg('rightbody.conceptdialog.type_value')}" />
                        </div>
                    </div>
                </div>
            </h:panelGroup>

            <!-- collection -->
            <div class="row" style="margin-top: 10px">
                <div class="col-12 md:col-4">
                    <b><h:outputText value="#{langueBean.getMsg('candidat.domaine')}" style="font-size: 14px;"/></b>
                </div>
                <div class="col-12 md:col-4">
                    <div class="ui-inputgroup">

                    </div>
                    <p:autoComplete value="#{candidatBean.candidatSelected.collections}" multiple="true" style="width=100%"
                                    var="values" forceSelection="true" completeMethod="#{candidatBean.searchCollection}"
                                    minQueryLength="1" itemLabel="#{values.value}" itemValue="#{values}"
                                    converter="searchConverterIdValue"
                                    scrollHeight="300">
                        <p:column>
                            <h:outputText title="#{values.id}" value="#{values.value}"/>
                        </p:column>
                    </p:autoComplete>
                </div>
            </div>

            <div class="row" style="margin-top: 10px">
                <div class="col-6">
                    <b><h:outputText value="#{langueBean.getMsg('candidat.generic_term')}" style="font-size: 14px;" /></b>
                </div>
                <div class="col-6">
                    <b><h:outputText value="#{langueBean.getMsg('candidat.associeted_terms')}" style="font-size: 14px;" /></b>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <!-- pour les relations BT -->
                    <p:autoComplete id="autoBroaderLink" value="#{candidatBean.candidatSelected.termesGenerique}"
                                    multiple="true" var="values" forceSelection="true" style="width: 100%;"
                                    completeMethod="#{candidatBean.searchTerme2}" minQueryLength="1" scrollHeight="300"
                                    itemLabel="#{values.value}" itemValue="#{values}" converter="searchConverterIdValue">
                        <p:column style="font-size: 12px;">
                            <h:outputText style="vertical-align: middle; margin-left: .5rem" title="#{values.id}" value="#{values.value}"/>
                        </p:column>
                    </p:autoComplete>
                </div>
                <div class="col-6">
                    <!-- pour les relations RT -->
                    <p:autoComplete id="autoRelatedLink" value="#{candidatBean.candidatSelected.termesAssocies}"
                                    multiple="true" var="values" forceSelection="true" style="width: 100%"
                                    completeMethod="#{candidatBean.searchTerme2}" minQueryLength="1" scrollHeight="300"
                                    itemLabel="#{values.value}" itemValue="#{values}" converter="searchConverterIdValue" >
                        <p:column  style="font-size: 12px;">
                            <h:outputText title="#{values.id}" value="#{values.value}" />
                        </p:column>
                    </p:autoComplete>
                </div>
            </div>

            <!-- pour les synonymes -->
            <div class="row" style="margin-top: 10px">
                <div class="col-12 md:col-4">
                    <b><h:outputText value="#{langueBean.getMsg('candidat.used_for')}" style="margin-top: 14px;"/></b>
                </div>
                <div class="col-12 md:col-4">
                    <p:inputText value="#{candidatBean.candidatSelected.employePour}"
                                 placeholder="Entrer ou virgule pour un autre label" style="width: 100%; height: 35px;"/>
                </div>
            </div>

            <!-- Validation et enregistrement des nouvelles données ci-dessus -->
            <div class="row" style="margin-top: 20px">
                <div class="col-12" style="text-align: right" >
                    <p:commandButton value="#{langueBean.getMsg('candidat.close')}" style="margin-right: 10px"
                                     icon="fas fa-undo-alt" styleClass="ui-button-secondary button"

                                     actionListener="#{candidatBean.setIsListCandidatsActivate(true)}"
                                     action="#{candidatBean.getAllCandidatsByThesoAndLangue()}"
                                     update="tabViewCandidat"/>

                    <p:commandButton value="#{langueBean.getMsg('candidat.save')}"
                                     icon="pi pi-check"
                                     styleClass="ui-button-success" action="#{candidatBean.saveConcept()}"
                                     update="messageIndex" />

                </div>
            </div>
        </div>
    </div>

    <!-- pour les 2 sections ci-dessous, l'enregistrement des données est automatique -->
    <h:panelGroup id="candidateInfos" rendered="#{!candidatBean.isNewCandidatActivate()}" style="margin: 10px;" >

        <!-- gestion des notes -->
        <div class="card mb-4 py-3 border-left-success" style="margin-top: 10px;">
            <div class="list-group" style="margin-top: -10px; margin-bottom: -10px; margin-left: 12px; margin-right: 12px">
                <!-- ligne PrefLabel -->
                <div class="row" style="margin-bottom: 10px">
                    <div class="col-12">
                        <b>
                            <p:commandLink value="#{langueBean.getMsg('rightbody.concept.add_note')}" actionListener="#{noteBeanCandidat.reset()}"
                                           oncomplete="PF('newNote').show();" update="idNewNote" ajax="true" process="@this">
                                <a class="fas fa-plus-circle" style="color: #f47b2a"  />
                            </p:commandLink>
                        </b>
                    </div>
                </div>

                <h:panelGroup rendered="#{candidatBean.candidatSelected.nodeNotes == null || candidatBean.candidatSelected.nodeNotes.size() == 0}">
                    <div class="row">
                        <div class="col-12">
                            <h:outputText value="Aucune note pour le moment ..." style="color: grey; font-style: italic"/>
                        </div>
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{candidatBean.candidatSelected.nodeNotes.size() > 0}" >
                    <div class="row" style="font-size: 12px; color: #601e18; margin-bottom: 5px">
                        <div class="col-4">
                            <b><h:outputText value="Valeur"/></b>
                        </div>
                        <div class="col-2">
                            <b><h:outputText value="Utilisateur"/></b>
                        </div>
                        <div class="col-2">
                            <b><h:outputText value="Type"/></b>
                        </div>
                        <div class="col-1">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.language')}"/></b>
                        </div>
                        <div class="col-1">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.edit')}"/></b>
                        </div>
                        <div class="col-1">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.remove')}"/></b>
                        </div>
                        <div class="col-1">
                            <b><h:outputText value="Vote"/></b>
                        </div>
                    </div>

                    <ui:repeat id="listNotes" var="note" value="#{candidatBean.candidatSelected.nodeNotes}" >
                        <div class="row" style="height: 35px;padding-top: 5px; background-color: #{viewEditionBean.getAlternateColor(candidatBean.candidatSelected.nodeNotes.indexOf(note))}"
                             tooltip="Ajouté par #{candidatBean.getUserName(note.idUser)}" tooltip-delay-show="500">
                            <div class="col-4" >
                                <h:outputText value="#{note.lexicalvalue}" escape="false" style="font-size: 14px;"/>
                            </div>
                            <div class="col-2" >
                                <h:outputText value="#{candidatBean.getUserName(note.idUser)}" escape="false" style="font-size: 14px;"/>
                            </div>
                            <div class="col-2" >
                                <h:outputText value="#{note.notetypecode}" escape="false" style="font-size: 14px;"/>
                            </div>
                            <div class="col-1" >
                                <img src="#{conceptView.getDrapeauImgLocal(note.lang)}" width="25" height="20"/>
                                <h:outputLabel value=" (#{note.lang})" style="font-size: 14px; margin-left: 10px;" />
                            </div>
                            <div class="col-1" style="margin-top: -5px">
                                <p:commandButton rendered="#{candidatBean.candidatSelected.userId == note.idUser}"
                                                 styleClass="rounded-button ui-button-outlined" icon="fas fa-pen" process="@this"
                                                 actionListener="#{noteBeanCandidat.resetEditNode(note)}" update="editNoteForm"
                                                 oncomplete="PF('editNote').show();" style="color: #43B572"/>

                            </div>
                            <div class="col-1" style="margin-top: -5px">
                                <p:commandButton rendered="#{candidatBean.candidatSelected.userId == note.idUser}" icon="pi pi-trash"
                                                 styleClass="rounded-button ui-button-danger ui-button-outlined" process="@this" ajax="true"
                                                 actionListener="#{noteBeanCandidat.setSelectedNodeNote(note)}" update="idDeleteNote"
                                                 oncomplete="PF('deleteNote').show();" />
                            </div>
                            <div class="col-1" style="margin-top: -5px">
                                <p:commandButton rendered="#{note.voted}" actionListener="#{candidatBean.addNoteVote(note)}"
                                                 update="tabViewCandidat messageIndex" ajax="true" process="@this"
                                                 styleClass="rounded-button ui-button-outlined"
                                                 icon="fas fa-thumbs-up" style="color: #E45C00; "/>

                                <p:commandButton rendered="#{!note.voted}" update="tabViewCandidat messageIndex"
                                                 icon="fas fa-thumbs-down" styleClass="rounded-button ui-button-outlined"
                                                 actionListener="#{candidatBean.addNoteVote(note)}" ajax="true" process="@this"
                                                 style="color: #666666"/>
                            </div>
                        </div>
                    </ui:repeat>
                </h:panelGroup>
            </div>
        </div>

        <div class="card mb-4 py-3 border-left-success" style="margin-top: 20px;">
            <div class="list-group" style="margin-top: -10px; margin-bottom: -10px; margin-left: 12px; margin-right: 12px">
                <!-- gestion des traductions -->
                <div class="row">
                    <div class="col-12">
                        <b>
                            <p:commandLink value="#{langueBean.getMsg('rightbody.concept.add_traduction')}" update="idNewTraduction newTraductionForm"
                                           oncomplete="PF('newTraduction').show();" actionListener="#{traductionService.init()}">
                                <a class="fas fa-plus-circle" style="color: #f47b2a" />
                            </p:commandLink>
                        </b>
                    </div>
                </div>

                <h:panelGroup rendered="#{candidatBean.candidatSelected.traductions.size() == 0}" style="margin-top: 10px">
                    <div class="row">
                        <div class="col-12">
                            <h:outputText  value="Aucune traduction pour le moment ..." style="color: grey; font-style: italic " />
                        </div>
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{candidatBean.candidatSelected.traductions.size() > 0}" style="margin-top: 10px">
                    <div class="row" style="font-size: 12px; color: #601e18; margin-bottom: 5px">
                        <div class="col-4" style="margin-top: -2px;">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.language')}"/></b>
                        </div>
                        <div class="col-4">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.traduction')}"/></b>
                        </div>
                        <div class="col-2">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.edit')}"/></b>
                        </div>
                        <div class="col-2">
                            <b><h:outputText value="#{langueBean.getMsg('candidat.remove')}"/></b>
                        </div>
                    </div>

                    <ui:repeat id="listTraduction" var="traduction" value="#{candidatBean.candidatSelected.traductions}">
                        <div class="row" style="background-color: #{viewEditionBean.getAlternateColor(candidatBean.candidatSelected.traductions.indexOf(traduction))};
                     padding-top: 5px" >
                            <div class="col-4" style="margin-top: -2px;">
                                <h:outputText value="#{traduction.langue}" style="font-size: 14px;"/>
                            </div>
                            <div class="col-4" style="margin-top: -2px;">
                                <h:outputText value="#{traduction.traduction}" style="font-size: 14px;"/>
                            </div>
                            <div class="col-2" style="margin-top: -5px">
                                <p:commandButton icon="fas fa-pen"
                                                 style="color: #43B572"
                                                 update=":manage-traduction-content"
                                                 oncomplete="PF('editTraduction').show();"
                                                 actionListener="#{traductionService.init(traduction)}" process="@this"
                                                 styleClass="rounded-button ui-button-outlined">
                                    <p:resetInput target=":manage-traduction-content"/>
                                </p:commandButton>
                            </div>

                            <div class="col-2" style="margin-top: -5px">
                                <p:commandButton icon="pi pi-trash" styleClass="rounded-button ui-button-danger ui-button-outlined"
                                                 actionListener="#{traductionService.init(traduction)}" update="confirmDeleteForm"
                                                 oncomplete="PF('confirmDeleteTraduction').show();" />
                            </div>
                        </div>
                    </ui:repeat>
                </h:panelGroup>
            </div>
        </div>
    </h:panelGroup>
</ui:fragment>
