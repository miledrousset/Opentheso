<ui:fragment xmlns="http://www.w3.org/1999/xhtml"  
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:p="http://primefaces.org/ui"
             xmlns:f="http://xmlns.jcp.org/jsf/core">

    <style>
        .hidden-row {
            display: none;
        }
    </style>

    <div class="card mb-4 py-3 border-left-success" style="margin-top: 5px; margin-left: 20px; margin-right: 20px; border-color: #43B572">
        <p:dataTable var="alignement" value="#{alignmentBean.allignementsList}"
                     filteredValue="#{alignmentBean.filteredAlignement}" size="small"
                     widgetVar="datatable" styleClass="products-table .ui-datatable-hor-scroll"
                     paginator="true"
                     paginatorPosition="bottom"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     selectionMode="single"
                     rowKey="#{alignement.idConceptOrig}"
                     rows="10"
                     resizableColumns="true"
                     showGridlines="true"
                     currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} #{langueBean.getMsg('rightbody.concept.alignment')}"
                     rowsPerPageTemplate="5,10,{ShowAll|'All'}"
                     scrollHeight="69%"
                     allowUnsorting="true"
                     sortMode="single"
                     style="margin-bottom: -17px; margin-top: -16px; font-size: 13px;" lazy="false"
                     rowStyleClass="#{alignement.typeAlignement eq null ? 'hidden-row' : null}">

            <p:headerRow field="idConceptOrig" expandable="true" expanded="true" rowStyleClass="#{alignement.typeAlignement eq null ? 'hidden-row' : null}">
                <p:column colspan="3" style="border-top: 1px solid #43B572; border-bottom: 1px solid #43B572; color: #143a1e;">
                    <h:outputText styleClass="ml-2" value="#{alignement.labelConceptOrig} (#{alignement.idConceptOrig})"/>
                </p:column>
                <p:column colspan="3" style="border-top: 1px solid #43B572; border-bottom: 1px solid #43B572; color: #143a1e; text-align: right;">
                    <p:commandButton process="@this" value="Alignement manuel"
                                     update=":containerIndex:searchAlignementForm"
                                     actionListener="#{alignmentBean.openEditAlignementWindow(alignement)}"
                                     styleClass="rounded-button ui-button-outlined"
                                     style="color: #f47b2a; text-align: right;" >
                        <p:resetInput target=":containerIndex:searchAlignementForm"/>
                    </p:commandButton>
                </p:column>
            </p:headerRow>

            <p:column headerText="#{langueBean.getMsg('search.identifier')}">
                <h:outputText value="#{alignement.idConceptOrig}" />
            </p:column>

            <p:column headerText="#{langueBean.getMsg('statistique.label')}">
                <h:outputText value="#{alignement.labelConceptOrig}" />
            </p:column>

            <p:column headerText="#{langueBean.getMsg('alignment.source')}">
                <h:outputText value="#{alignement.thesaurus_target}" />
            </p:column>

            <p:column headerText="#{langueBean.getMsg('rightbody.conceptdialog.type_of_alignmnent')}">
                <h:outputText value="#{alignement.typeAlignement}" />
            </p:column>

            <p:column headerText="#{langueBean.getMsg('rightbody.conceptdialog.uriTarget')}" style="text-align: center">
                <h:panelGroup rendered="#{alignement.valide}">
                    <h:outputLink value="#{alignement.targetUri}" target="_blank" >
                        <i class="pi pi-link" style="font-size: 1rem; color: green" />
                    </h:outputLink>
                </h:panelGroup>
                <h:panelGroup rendered="#{!alignement.valide}">
                    <i class="pi pi-times-circle" style="font-size: 1rem; color: red" />
                </h:panelGroup>
            </p:column>

            <p:column headerText="Actions" style="text-align: center"
                      rowStyleClass="#{alignement.labelConceptOrig eq null ? 'hidden-row' : null}">
                <div class="row">
                    <div class="col-5 offset-1">
                        <p:commandButton process="@this" rendered="#{alignement.targetUri != null}"
                                         action="#{alignmentManualBean.reset()}"
                                         actionListener="#{alignmentBean.setAlignementElementSelected(alignement)}"
                                         update=":containerIndex:idUpdateSingleAlignment"
                                         oncomplete="PF('updateSingleAlignment').show();"
                                         icon="pi pi-pencil" styleClass="rounded-button ui-button-outlined"
                                         style="height: 30px; width: 30px; color: #43B572" />
                    </div>
                    <div class="col-5">
                        <p:commandButton process="@this" ajax="true"
                                         icon="pi pi-trash" styleClass="rounded-button ui-button-danger ui-button-outlined"
                                         oncomplete="PF('confirmDeleteAlignement').show()"
                                         actionListener="#{alignmentBean.setAlignementElementSelected(alignement)}"
                                         rendered="#{alignement.targetUri != null}"
                                         style="height: 30px; width: 30px;" />
                    </div>
                </div>
            </p:column>

            <p:summaryRow rowStyleClass="#{alignement.typeAlignement eq null ? 'hidden-row' : null}">
                <p:column colspan="6" style="text-align:right; background-color: #ecf8f1;
              border-top: 1px solid #43B572; border-bottom: 1px solid #43B572; color: #143a1e">
                    <h:outputText value="#{langueBean.getMsg('alignment.totalAlignmentFor')} (#{alignement.getLabelConceptOrig()}) : #{alignmentBean.getTotalAlignementParConcept(alignement.idConceptOrig)}"/>
                </p:column>
            </p:summaryRow>

            <f:facet name="footer" rowStyleClass="#{alignement.typeAlignement eq null ? 'hidden-row' : null}">
                <span class="p-text-bold" >
                    <h:outputText value="#{langueBean.getMsg('rightbody.alignmentNumber')} : " style="font-size: 14px;"/>
                    <h:outputText value="#{alignmentBean.getTotalAlignements()}" style="font-size: 16px; color: #f47b2a"/>
                </span>
            </f:facet>
        </p:dataTable>
    </div>

    <script>
        function ouvrirURL(url) {
            window.open(url, "_blank");
        }
    </script>
</ui:fragment>
